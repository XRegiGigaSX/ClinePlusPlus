<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PostgreSQL Table Viewer</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f7f9fa; margin: 0; padding: 0; }
        .container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); padding: 32px 28px 24px 28px; }
        h2 { color: #222; margin-bottom: 24px; }
        table { width: 100%; border-collapse: collapse; background: #fff; }
        th, td { padding: 8px 10px; border-bottom: 1px solid #e0e0e0; text-align: left; }
        th { background: #f0f2f5; }
        .error { color: #e53935; margin-bottom: 18px; }
    </style>
</head>
<body>
    <div class="container">
        <h2 id="table-title">PostgreSQL Table</h2>
        <div id="error-msg" class="error"></div>
        <table id="pg-table">
            <thead id="pg-table-head"></thead>
            <tbody id="pg-table-body"></tbody>
        </table>
    </div>
    <script>
        function getTableName() {
            const params = new URLSearchParams(window.location.search);
            return params.get('table');
        }
        async function fetchTableData(table) {
            try {
                const res = await fetch(`/api/pg_table?table=${encodeURIComponent(table)}`);
                const data = await res.json();
                if (!data.success) throw new Error(data.error || 'Failed to fetch table');
                return data;
            } catch (e) {
                document.getElementById('error-msg').textContent = e.message;
                return null;
            }
        }
        function renderTable(columns, rows) {
            const thead = document.getElementById('pg-table-head');
            const tbody = document.getElementById('pg-table-body');
            thead.innerHTML = '<tr>' + columns.map(col => `<th>${col}</th>`).join('') + '</tr>';
            tbody.innerHTML = rows.length ? rows.map(row => `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`).join('') : '<tr><td colspan="'+columns.length+'" style="text-align:center; color:#888;">No data</td></tr>';
        }
        (async function() {
            const table = getTableName();
            if (!table) {
                document.getElementById('error-msg').textContent = 'No table specified.';
                return;
            }
            document.getElementById('table-title').textContent = `PostgreSQL Table: ${table}`;
            const data = await fetchTableData(table);
            if (data && data.success) {
                renderTable(data.columns, data.rows);
            }
        })();
    </script>
</body>
</html>
